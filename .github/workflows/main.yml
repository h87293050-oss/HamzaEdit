name: AvicaRDP
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # Har 6 ghante baad auto restart

jobs:
  build:
    name: Start Building...
    runs-on: windows-latest
    timeout-minutes: 350  # Zyada time limit
    
    steps:
      - name: Direct Avica Setup
        run: |
          Write-Host "🚀 Avica setup shuro ho raha hai..." -ForegroundColor Green
          
          # Files directly download karo
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py" -OutFile "setup.py"
          Invoke-WebRequest -Uri "https://download.avica.com/AvicaLite_v8.0.8.9.exe" -OutFile "Avica_setup.exe"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat"
          
          # Python packages install karo
          python.exe -m pip install requests pyautogui telegraph --quiet
          
          # RDP ko enable karo
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          
          # User password set karo
          net user runneradmin TheDisa1a
          
          # Avica shuro karo
          Write-Host "⚡ Avica shuro ho raha hai..." -ForegroundColor Yellow
          python -c "import pyautogui as pag; pag.click(897, 64, duration=2)" 2>$null
          Start-Process "Avica_setup.exe"
          
          # Setup script chalayo
          python setup.py
          
          Write-Host "✅ Setup mukammal! GoFile link check karo!" -ForegroundColor Green
          
      - name: System User Setup Karo
        run: |
          net user runneradmin TheDisa1a
          Write-Host "✅ System user tayyar hai" -ForegroundColor Green
          
      - name: CMD Minimized Mein Kholo
        run: |
          # CMD minimized mode mein kholo background mein
          $scriptBlock = {
            cmd.exe /c "echo ╔══════════════════════════════════════╗ && echo ║        AVICA RDP CONNECTION          ║ && echo ╚══════════════════════════════════════╝ && echo. && echo 📱 WhatsApp: +923091645255 && echo 👨‍💻 Created by HamzaEditz && echo Telegram: https://t.me/hamzaeditz2 && echo. && echo 📋 Instructions: && echo • GoFile link neeche ayega && echo • Wahan se Avica ID aur Password lo && echo • Avica app download karo aur connect karo && echo • GoFile link har bar badalta hai! && echo. && echo ⏳ GoFile link ka intezar... && timeout 86400"
          }
          
          # Hidden window style ke sath CMD shuro karo
          $processInfo = New-Object System.Diagnostics.ProcessStartInfo
          $processInfo.FileName = "cmd.exe"
          $processInfo.Arguments = "/c echo Connection Info Displayed && timeout 5"
          $processInfo.WindowStyle = [System.Diagnostics.ProcessWindowStyle]::Minimized
          $process = [System.Diagnostics.Process]::Start($processInfo)
          
          Write-Host "✅ CMD minimized mode mein chalu ho gaya" -ForegroundColor Green
          
      - name: Avica Service Shuro Karo
        run: |
          # show.bat minimized chalayo
          $process = Start-Process -FilePath "cmd.exe" -ArgumentList "/c", "show.bat" -WindowStyle Minimized -PassThru
          Write-Host "✅ Avica service chalu ho gayi (minimized)" -ForegroundColor Green
          
      - name: Session Ko Active Rakho
        run: |
          Write-Host "🚀 Avica shuro ho raha hai... CONNECTION ID talash karo!" -ForegroundColor Yellow
          # loop.bat minimized chalayo
          $process = Start-Process -FilePath "cmd.exe" -ArgumentList "/c", "loop.bat" -WindowStyle Minimized -PassThru
          Write-Host "✅ Session active rakhi ja rahi hai (background mein)" -ForegroundColor Green
