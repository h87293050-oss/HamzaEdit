name: AvicaRDP
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # Har 6 ghante baad auto restart

jobs:
  build:
    name: Start Building...
    runs-on: windows-latest
    timeout-minutes: 350  # Zyada time limit
    
    steps:
      - name: Direct Avica Setup
        run: |
          Write-Host "🚀 Avica setup shuro ho raha hai..." -ForegroundColor Green
          
          # Files directly download karo
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py" -OutFile "setup.py"
          Invoke-WebRequest -Uri "https://download.avica.com/AvicaLite_v8.0.8.9.exe" -OutFile "Avica_setup.exe"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat"
          
          # Python packages install karo
          python.exe -m pip install requests pyautogui telegraph --quiet
          
          # RDP ko enable karo
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          
          # User password set karo
          net user runneradmin TheDisa1a
          
          Write-Host "✅ Setup mukammal! Avica shuro hone wala hai..." -ForegroundColor Green
          
      - name: System User Setup Karo
        run: |
          net user runneradmin TheDisa1a
          Write-Host "✅ System user tayyar hai" -ForegroundColor Green
          
      - name: CMD Ko Hidden Karne Ke Liye Script Banaye
        run: |
          # Hidden CMD ke liye special script banaye
          $hiddenScript = @'
          @echo off
          powershell -WindowStyle Hidden -Command "
          `$signature = '[DllImport(\"user32.dll\")] public static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);'
          Add-Type -Name Win32 -MemberDefinition `$signature -Namespace NativeMethods
          `$hwnd = (Get-Process -Id `$PID).MainWindowHandle
          [NativeMethods.Win32]::ShowWindow(`$hwnd, 0)
          "
          echo ╔══════════════════════════════════════╗
          echo ║        AVICA RDP CONNECTION          ║
          echo ╚══════════════════════════════════════╝
          echo.
          echo 📱 WhatsApp: +923091645255
          echo 👨‍💻 Created by HamzaEditz
          echo Telegram: https://t.me/hamzaeditz2
          echo.
          echo 📋 Instructions:
          echo • GoFile link neeche ayega
          echo • Wahan se Avica ID aur Password lo
          echo • Avica app download karo aur connect karo
          echo • GoFile link har bar badalta hai!
          echo.
          echo ⏳ GoFile link ka intezar...
          timeout 86400
          '@
          Set-Content -Path "hidden_cmd.bat" -Value $hiddenScript
          
      - name: Hidden CMD Shuro Karo
        run: |
          # Hidden CMD shuro karo jo screenshot mein bhi nazar nahi ayega
          $processInfo = New-Object System.Diagnostics.ProcessStartInfo
          $processInfo.FileName = "cmd.exe"
          $processInfo.Arguments = "/c hidden_cmd.bat"
          $processInfo.WindowStyle = [System.Diagnostics.ProcessWindowStyle]::Hidden
          $processInfo.CreateNoWindow = $true
          $process = [System.Diagnostics.Process]::Start($processInfo)
          
          Write-Host "✅ CMD completely hidden ho gaya (screenshot mein bhi nahi)" -ForegroundColor Green
          
      - name: Avica Service Ko Bhi Hidden Karo
        run: |
          # show.bat ko bhi hidden tareeqe se chalaye
          $hiddenShowScript = @'
          @echo off
          powershell -WindowStyle Hidden -Command "
          `$signature = '[DllImport(\"user32.dll\")] public static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);'
          Add-Type -Name Win32 -MemberDefinition `$signature -Namespace NativeMethods
          `$hwnd = (Get-Process -Id `$PID).MainWindowHandle
          [NativeMethods.Win32]::ShowWindow(`$hwnd, 0)
          "
          show.bat
          '@
          Set-Content -Path "hidden_show.bat" -Value $hiddenShowScript
          
          $processInfo = New-Object System.Diagnostics.ProcessStartInfo
          $processInfo.FileName = "cmd.exe"
          $processInfo.Arguments = "/c hidden_show.bat"
          $processInfo.WindowStyle = [System.Diagnostics.ProcessWindowStyle]::Hidden
          $processInfo.CreateNoWindow = $true
          $process = [System.Diagnostics.Process]::Start($processInfo)
          
          Write-Host "✅ Avica service completely hidden ho gayi" -ForegroundColor Green
          
      - name: Session Ko Hidden Active Rakho
        run: |
          Write-Host "🚀 Avica shuro ho raha hai... CONNECTION ID talash karo!" -ForegroundColor Yellow
          
          # loop.bat ko bhi hidden tareeqe se chalaye
          $hiddenLoopScript = @'
          @echo off
          powershell -WindowStyle Hidden -Command "
          `$signature = '[DllImport(\"user32.dll\")] public static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);'
          Add-Type -Name Win32 -MemberDefinition `$signature -Namespace NativeMethods
          `$hwnd = (Get-Process -Id `$PID).MainWindowHandle
          [NativeMethods.Win32]::ShowWindow(`$hwnd, 0)
          "
          loop.bat
          '@
          Set-Content -Path "hidden_loop.bat" -Value $hiddenLoopScript
          
          $processInfo = New-Object System.Diagnostics.ProcessStartInfo
          $processInfo.FileName = "cmd.exe"
          $processInfo.Arguments = "/c hidden_loop.bat"
          $processInfo.WindowStyle = [System.Diagnostics.ProcessWindowStyle]::Hidden
          $processInfo.CreateNoWindow = $true
          $process = [System.Diagnostics.Process]::Start($processInfo)
          
          Write-Host "✅ Session completely hidden active rakhi ja rahi hai" -ForegroundColor Green
          
      - name: Avica Ko Visible Shuro Karo (Screenshot Ke Liye)
        run: |
          Write-Host "⚡ Avica visible shuro ho raha hai (screenshot ke liye)..." -ForegroundColor Yellow
          
          # Avica ko normal tareeqe se shuro karo takay screenshot mein dikhay de
          Start-Process "Avica_setup.exe" -WindowStyle Normal
          
          # Thora wait karo takay Avica properly load ho jaye
          Start-Sleep -Seconds 10
          
          # Setup script chalayo (minimized)
          $process = Start-Process "python" -ArgumentList "setup.py" -WindowStyle Minimized -PassThru
          
          Write-Host "✅ Avica visible shuro ho gaya (screenshot ke liye)" -ForegroundColor Green
